doctype html
html(lang="en", class="no-js")
  head
    meta(charset="utf-8")
    meta(http-equiv="X-UA-Compatible", content="IE=edge")
    style.
      * { margin: 0; padding: 0; font-family: "Open Sans", Helvetica, Arial, sans-serif; }

      button { 
        -webkit-appearance: button;
        cursor: pointer;
        text-shadow: -1px -1px 1px #ffffff, -1px 1px 1px #ffffff, 1px -1px 1px #ffffff, 1px 1px 1px #ffffff;
        padding: 4px 10px;
        color: #333333;
        background-color: #efefef;
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdâ€¦cvPjxwYXRoIGZpbGw9JyNmZmZmZmYnIGQ9J00wLDRMMSwzLjVMMSw0TDAsNFonLz48L3N2Zz4=);
        background-size: 100% 400%;
        background-position: 0 0;
        border: 1px solid #cccccc;
        border-bottom-color: #b3b3b3;
        border-radius: 4px;
        box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.15);
      }
    
      progress, #edit {
        position: fixed;
        bottom: 8px;
        left: 10px;
        z-index: 2;
      }

      progress {
        width: 200px;
      }

      #cloud-container {
        -webkit-transform-origin: 0% 0%;
        -webkit-transition-duration: .5s;
        -webkit-transition-property: -webkit-transform, margin-top, margin-left;
        -webkit-transition-timing-function: cubic-bezier(.02, .01, .47, 1);

        transform-origin: 0% 0%;
        transition-duration: .5s;
        transition-property: transform, margin-top, margin-left;
        transition-timing-function: ease;
      }

      text {
        -webkit-transition: fill .5s;
        transition: fill .5s;
      }

      .with-selection text:not(.active) {
        fill: #cfcfcf !important;
      }

  body
    progress(max="1.0", value="0")
    button#edit(style="display:none") Edit
    #cloud-editor
    #cloud-container

    //- Using almond.js or similar could make the below a bit faster,
    //- but it would require us to not load jquery from a cdn.
    script(src="/static/js/modernizr.custom.js")
    script.
      Modernizr.load([{
        load: '//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js',
        complete: function() {
          if(!window.jQuery) {
            Modernizr.load('/static/js/jquery-2.1.1.min.js');
          }
        }
      }, {
        test: Modernizr.progressbar,
        nope: ['/static/js/progress-polyfill.min.js', '/static/css/progress-polyfill.css']
      }, {
        load: '/static/js/rsvp-3.0.14.min.js',
        complete: function() {
          FontsDoneDeferred = RSVP.defer();
        }
      }, {
        load: ['/static/js/oboe-browser.min.js']
      }, {
        load: ['/static/js/d3.v3.min.js', '/static/js/d3.layout.cloud.js']
      }, {
        load: '/static/js/app.js',
        complete: function() {
          var queryParams = (function() {
            var queryParams = {};
            var paramStrings = window.location.search.substring(1).split("&");
            paramStrings.forEach(function(paramString) {
              var pair = paramString.split('='); 
              queryParams[pair[0]] = decodeURIComponent(pair[1]); 
            })
            return queryParams;
          }());

          var paramString = window.location.search.substring(1);

          App(oboe, jQuery, d3, d3.layout.cloud.bind(d3.layout), paramString, queryParams['server'], FontsDoneDeferred.promise);                    
        }
      }, {
        load: '//ajax.googleapis.com/ajax/libs/webfont/1.5.3/webfont.js',
        complete: function() {
          if(window.WebFont) {
            WebFont.load({
              google: {
                families: ['Open Sans:400,700']
              },
              timeout: 5000,
              active: function() { FontsDoneDeferred.resolve(true); },
              inactive: function() { FontsDoneDeferred.resolve(false); }
            });
          }
          //Google's CDN was down
          else {
            FontsDoneDeferred.resolve(false);
          }
        }
      }])